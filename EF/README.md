# 电动平场板控制系统

## 功能概述

这是一个基于ESP32的电动平场板控制系统，通过Blynk应用程序进行远程控制。

### 主要功能

1. **舵机控制 (V1)**
   - 开关控制
   - 开启时：舵机旋转到保存的角度
   - 关闭时：舵机旋转到0度
   - 硬件连接：IO4
   - 舵机参数：500-2500us脉冲宽度，可控300度

2. **舵机角度设置 (V4)**
   - 滑块控制 (0-300度)
   - 设置舵机开启时的旋转角度
   - 角度值自动保存到EEPROM
   - 重启后自动恢复保存的角度

3. **加热带控制 (V3)**
   - 开关控制
   - 开启/关闭加热带
   - 硬件连接：IO5

4. **LED开关控制 (V2)**
   - 开关控制
   - 开启/关闭LED
   - 硬件连接：IO21

5. **LED亮度设置 (V5)**
   - 滑块控制 (0-100%)
   - 设置LED的亮度级别
   - 亮度值自动保存到EEPROM
   - 重启后自动恢复保存的亮度

6. **自动加热带开关 (V6)**
   - 开关控制
   - 控制IoT板子的自动加热带功能
   - 设置自动保存到EEPROM
   - 通过ESP-NOW发送到IoT板子

7. **湿度阈值设置 (V7)**
   - 滑块控制 (0-100%)
   - 设置IoT板子的湿度阈值
   - 阈值自动保存到EEPROM
   - 通过ESP-NOW发送到IoT板子

## 硬件要求

- ESP32开发板
- 舵机 (连接到IO4)
- LED灯 (连接到IO21)
- 加热带 (连接到IO5)
- 电源供应

## 软件要求

### Arduino库
- WiFi.h (ESP32内置)
- WiFiClient.h (ESP32内置)
- BlynkSimpleEsp32.h
- ESP32Servo.h
- EEPROM.h (ESP32内置)

### Blynk应用程序设置

1. 创建新的Blynk项目
2. 添加以下控件：
   - **V0**: Terminal (终端) - 系统信息输出
   - **V1**: Switch (开关) - 舵机控制
   - **V2**: Switch (开关) - LED开关控制
   - **V3**: Switch (开关) - 加热带控制
   - **V4**: Slider (滑块) - 舵机角度设置 (范围: 0-300)
   - **V5**: Slider (滑块) - LED亮度设置 (范围: 0-100)
   - **V6**: Switch (开关) - 自动加热带开关
   - **V7**: Slider (滑块) - 湿度阈值设置 (范围: 0-100)

## 安装步骤

1. **下载代码**
   - 下载 `电动平场板控制.ino` 和 `config.h` 文件

2. **配置参数**
   - 修改 `config.h` 中的WiFi和Blynk参数
   - 确保Blynk认证令牌正确

3. **安装库**
   - 在Arduino IDE中安装BlynkSimpleEsp32库
   - 安装ESP32Servo库

4. **编译上传**
   - 选择正确的ESP32开发板
   - 编译并上传代码到ESP32

5. **测试**
   - 打开串行监视器查看连接状态
   - 使用Blynk应用程序测试各项功能

## 引脚定义

| 功能 | 引脚 | 说明 |
|------|------|------|
| 舵机控制 | IO4 | PWM输出，控制舵机角度 |
| LED控制 | IO21 | PWM输出，控制LED亮度 |
| 加热带控制 | IO5 | 数字输出，控制加热带开关 |

## Blynk引脚说明

| 虚拟引脚 | 功能 | 控件类型 | 参数范围 |
|----------|------|----------|----------|
| V0 | 终端输出 | Terminal | 文本信息 |
| V1 | 舵机开关控制 | Switch | 0/1 |
| V2 | LED开关控制 | Switch | 0/1 |
| V3 | 加热带控制 | Switch | 0/1 |
| V4 | 舵机角度设置 | Slider | 0-300 |
| V5 | LED亮度设置 | Slider | 0-100 |
| V6 | 自动加热带开关 | Switch | 0/1 |
| V7 | 湿度阈值设置 | Slider | 0-100 |

## 配置说明

所有引脚定义和Blynk配置都在 `config.h` 文件中，包括：
- WiFi连接参数
- Blynk服务器配置
- 物理引脚定义
- Blynk虚拟引脚定义
- ESP-NOW配置
- EEPROM地址定义

如需修改引脚分配或Blynk设置，请编辑 `config.h` 文件。

## ESP-NOW通讯说明

平场板ESP32通过ESP-NOW与IoT板子进行通讯：
- 平场板作为发送方，IoT板子作为接收方
- 通讯内容包括自动加热带开关状态和湿度阈值
- 需要在config.h中配置正确的MAC地址
- 所有配置都会自动保存到EEPROM并发送到IoT板子

## 故障排除

1. **WiFi连接失败**
   - 检查WiFi SSID和密码是否正确
   - 确保ESP32在WiFi信号范围内

2. **Blynk连接失败**
   - 检查认证令牌是否正确
   - 确认服务器地址和端口设置

3. **舵机不工作**
   - 检查舵机电源供应
   - 确认舵机信号线连接到IO4

4. **LED不亮**
   - 检查LED连接和电源
   - 确认IO21引脚连接正确

## 注意事项

- 确保舵机有足够的电源供应
- LED可能需要限流电阻
- 加热带需要适当的散热设计
- 建议使用外部电源为舵机和加热带供电
- 角度设置会自动保存，重启后恢复

## 版本信息

- 版本：1.0
- 日期：2024
- 作者：远程天文台控制系统 